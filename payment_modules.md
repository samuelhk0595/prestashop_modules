# Payment Modules (PrestaShop 9)

PrestaShop 1.7+ introduced a new payment API. Payment modules must follow specific security and structural rules.

## Requirements
1. Class must extend `PaymentModule`.
2. Must implement and register `hookPaymentOptions()` and `hookPaymentReturn()`.
3. **No submit button** in module HTML (it's generated by PrestaShop).

## Generating PaymentOptions
Return an array of `PaymentOption` objects in `hookPaymentOptions()`:

```php
public function hookPaymentOptions($params)
{
    if (!$this->active) {
        return;
    }

    $option = new \PrestaShop\PrestaShop\Core\Payment\PaymentOption();
    $option->setCallToActionText($this->l('Pay by Bank Wire'))
           ->setAction($this->context->link->getModuleLink($this->name, 'validation', [], true))
           ->setAdditionalInformation($this->fetch('module:bankwire/views/templates/hook/infos.tpl'));

    return [$option];
}
```

## Payment Scenarios
- **Offline**: Simple redirect to order confirmation (e.g., Bankwire).
- **External**: Redirect to a Payment Service Provider (PSP) website (e.g., PayPal).
- **Embedded**: Credit card fields directly on the merchant's site (e.g., Stripe).
- **Iframe**: PSP form displayed within an iframe.

## Security Rules
- Always double-check `id_cart` before creating the order.
- Use the amount from the PSP response for `validateOrder()`, not `Cart->getOrderTotal()`.
- Validate the source of callbacks using tokens or signatures.
